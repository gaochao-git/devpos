#inception osc变量配置表
CREATE TABLE `inception_variable_config` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `variable_name` varchar(200) NOT NULL DEFAULT '' COMMENT '变量名',
  `variable_value` varchar(200) NOT NULL DEFAULT '' COMMENT '变量值',
  `variable_description` varchar(2000) DEFAULT NULL COMMENT '参数解释',
  `editable` tinyint(1) DEFAULT '1' COMMENT '1-->可编辑,2-->不可编辑',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=utf8 COMMENT='inception 变量配置表';

#请求工单检查结果
CREATE TABLE `sql_check_results` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `submit_sql_uuid` varchar(50) NOT NULL COMMENT '请求uuid',
  `inception_id` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception返回的ID',
  `inception_stage` varchar(20) NOT NULL DEFAULT '' COMMENT 'Inception返回的stage',
  `inception_error_level` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception返回的错误号码',
  `inception_stage_status` varchar(64) NOT NULL DEFAULT 'Inception返回的stage status',
  `inception_error_message` text NOT NULL COMMENT 'Inception返回的错误信息',
  `inception_sql` text COMMENT 'Inception返回的需要执行的SQL',
  `inception_affected_rows` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception返回的影响行数',
  `inception_sequence` varchar(255) NOT NULL DEFAULT '' COMMENT 'Inception返回的回滚备份序列号',
  `inception_backup_dbnames` varchar(255) NOT NULL DEFAULT '' COMMENT 'Inception返回的数据库名称',
  `inception_execute_time` varchar(100) NOT NULL DEFAULT '0' COMMENT 'Inception返回的执行耗时',
  `inception_sqlsha1` varchar(255) NOT NULL DEFAULT '' COMMENT 'Inception返回的sqlsha1',
  `inception_command` varchar(255) NOT NULL DEFAULT '' COMMENT 'Inception返回的command',
  `inception_executed_time` varchar(100) NOT NULL DEFAULT '' COMMENT 'inception get osc_percent返回的该sql已经执行多长时间',
  `inception_remain_time` varchar(100) NOT NULL DEFAULT '' COMMENT 'inception get osc_percent返回的该sql预计还有多长时间执行完',
  `inception_execute_percent` int(11) NOT NULL DEFAULT '0' COMMENT 'inception get osc_percent返回的该sql执行进度',
  `ctime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `utime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=823 DEFAULT CHARSET=utf8mb4 COMMENT='SQL检查结果表';

#SQL请求工单详细信息
CREATE TABLE `sql_execute` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `submit_sql_uuid` varchar(50) NOT NULL COMMENT '请求uuid',
  `submit_sql_user` varchar(50) NOT NULL COMMENT '提交SQL用户',
  `submit_sql_file_path` varchar(200) NOT NULL COMMENT '请求sql存放路径',
  `title` varchar(50) NOT NULL COMMENT '标题',
  `leader_user_name` varchar(50) NOT NULL DEFAULT '' COMMENT '开发leader',
  `qa_user_name` varchar(50) NOT NULL DEFAULT '' COMMENT '测试人员',
  `dba_check_user_name` varchar(50) NOT NULL DEFAULT '' COMMENT 'dba审核人员',
  `dba_execute_user_name` varchar(50) NOT NULL DEFAULT '' COMMENT 'dba执行人员',
  `master_ip` varchar(50) NOT NULL COMMENT '主库ip',
  `master_port` int(11) NOT NULL COMMENT '主库port',
  `comment_info` varchar(200) NOT NULL DEFAULT '' COMMENT 'sql说明',
  `leader_check` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'leader审核:1-->未审核,2-->审核通过,3-->审核不通过',
  `qa_check` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'qa审核:1-->未审核,2-->审核通过,3-->审核不通过',
  `dba_check` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'dba审核:1-->未审核,2-->审核通过,3-->审核不通过',
  `submit_sql_execute_type` varchar(50) NOT NULL DEFAULT '' COMMENT '执行类型',
  `inception_osc_config` varchar(10000) NOT NULL DEFAULT '' COMMENT 'OSC 配置,必须为json格式',
  `inception_backup` tinyint(2) NOT NULL DEFAULT '1' COMMENT '是否备份, 0不备份, 1备份',
  `inception_check_ignore_warning` tinyint(2) NOT NULL DEFAULT '0' COMMENT 'inception是否忽略检查警告继续执行,0-->不忽略警告,1-->忽略警告',
  `inception_execute_ignore_error` tinyint(2) NOT NULL DEFAULT '0' COMMENT 'inception执行遇到错误是否继续执行,0-->不继续执行,1-->继续执行',
  `dba_execute` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'dba执行:1-->未执行,2-->已执行',
  `execute_status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态:1-->未执行,2-->执行中,3-->执行成功,4-->执行失败,5-->执行成功含警告,999-->未知',
  `ctime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `utime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=291 DEFAULT CHARSET=utf8mb4 COMMENT='SQL工单';

#工单执行结果表
CREATE TABLE `sql_execute_results` (
  `id` int(4) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `submit_sql_uuid` varchar(50) NOT NULL COMMENT '请求uuid',
  `split_seq` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception返回的拆分ID',
  `split_sql_file_path` varchar(200) NOT NULL COMMENT '请求sql存放路径',
  `rerun_seq` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception执行失败后平台生成的重做序列号',
  `inception_id` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception返回的ID',
  `inception_stage` varchar(20) NOT NULL DEFAULT '' COMMENT 'Inception返回的stage',
  `inception_error_level` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception返回的错误号码',
  `inception_error_stage` varchar(64) NOT NULL DEFAULT 'Inception返回的errstage',
  `inception_error_message` text NOT NULL COMMENT 'Inception返回的错误  信息',
  `inception_sql` text COMMENT 'Inception返回的问题SQL内容',
  `inception_affected_rows` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception返回的影响行数',
  `inception_sequence` varchar(255) NOT NULL DEFAULT '' COMMENT 'Inception返回的回滚备份序列号',
  `inception_backup_dbname` varchar(255) NOT NULL DEFAULT '' COMMENT 'Inception返回的数据库名称',
  `inception_execute_time` decimal(16,4) NOT NULL DEFAULT '0.0000' COMMENT '执行耗时',
  `ctime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `utime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=730 DEFAULT CHARSET=utf8mb4 COMMENT='执行结果表';

#SQL工单拆分SQL表
CREATE TABLE `sql_execute_split` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键',
  `submit_sql_uuid` varchar(50) NOT NULL COMMENT '请求uuid',
  `split_seq` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception返回的拆分ID',
  `rerun_seq` int(11) NOT NULL DEFAULT '0' COMMENT 'Inception执行失败后平台生成的重做序列号',
  `rerun_flag` tinyint(4) NOT NULL DEFAULT '-1' COMMENT '执行失败生成重做数据状态 0生成重做数据成功 1生成重做数据失败',
  `ddlflag` tinyint(4) NOT NULL DEFAULT '-1' COMMENT 'Inception返回的ddlflag 0不含DDL, 1含DDL',
  `sql_num` int(11) NOT NULL DEFAULT '1' COMMENT '一个split sql file中包含的sql数量',
  `split_sql_file_path` varchar(200) NOT NULL COMMENT '请求sql存放路径',
  `master_ip` varchar(50) NOT NULL COMMENT '主库ip',
  `master_port` int(11) NOT NULL COMMENT '主库port',
  `submit_sql_execute_type` varchar(50) NOT NULL DEFAULT '' COMMENT '执行类型',
  `inception_osc_config` varchar(10000) NOT NULL DEFAULT '' COMMENT 'OSC 配置,必须为json格式',
  `inception_backup` tinyint(2) NOT NULL DEFAULT '1' COMMENT '是否备份, 0不备份, 1备份',
  `inception_check_ignore_warning` tinyint(2) NOT NULL DEFAULT '0' COMMENT 'inception是否忽略检查警告继续执行,0-->不忽略警告,1-->忽略警告',
  `inception_execute_ignore_error` tinyint(2) NOT NULL DEFAULT '0' COMMENT 'inception执行遇到错误是否继续执行,0-->不继续执行,1-->继续执行',
  `dba_execute` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'dba执行:1-->未执行,2-->已执行',
  `execute_status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态:1-->未执行,2-->执行中,3-->执行成功,4-->执行失败,5-->执行成功含警告,999-->未知',
  `ctime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `utime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=300 DEFAULT CHARSET=utf8mb4 COMMENT='SQL拆分表';